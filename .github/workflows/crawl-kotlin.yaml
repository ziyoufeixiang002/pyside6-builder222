#!/bin/bash

# 设置变量
BASE_URLS=("https://kotlinlang.org/docs/" "https://kotlinlang.org/api/")
OUTPUT_DIR="kotlin_docs"
MAX_DEPTH=10  # 最大递归深度
USER_AGENT="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"

# 创建输出目录
mkdir -p $OUTPUT_DIR
cd $OUTPUT_DIR

echo "开始爬取 Kotlin 文档..."

# 使用 wget 递归下载文档
for url in "${BASE_URLS[@]}"; do
    echo "正在爬取: $url"
    
    wget \
        --recursive \
        --level=$MAX_DEPTH \
        --no-parent \
        --page-requisites \
        --html-extension \
        --convert-links \
        --adjust-extension \
        --restrict-file-names=windows \
        --domains=kotlinlang.org \
        --reject="*.jpg,*.jpeg,*.png,*.gif,*.bmp,*.svg,*.ico" \
        --reject="*.mp3,*.wav,*.ogg,*.mp4,*.avi,*.mov,*.webm" \
        --reject="*.pdf,*.zip,*.tar,*.gz" \
        --timeout=30 \
        --tries=3 \
        --wait=2 \
        --random-wait \
        --user-agent="$USER_AGENT" \
        --directory-prefix=. \
        "$url"
done

# 统计下载的文件
HTML_COUNT=$(find . -name "*.html" -o -name "*.htm" | wc -l)
TOTAL_FILES=$(find . -type f | wc -l)

echo "爬取完成!"
echo "下载的HTML文件: $HTML_COUNT"
echo "总文件数: $TOTAL_FILES"
echo "文档已保存到: $OUTPUT_DIR"

# 创建索引文件
find . -name "*.html" -o -name "*.htm" | sort > ../doc_index.txt
echo "索引文件已创建: doc_index.txt"
